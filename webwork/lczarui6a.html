<!DOCTYPE HTML>
<HTML>
<head>
<meta charset="UTF-8">
<style type="text/css">
</style>
</head>
<body>
<div id="candiv" style="position: absolute; top: 50px; left: 50px;">
<canvas id="canvas" width="500" height="500">
!supported
</canvas>
</div>
<script type = "text/javascript">
window.addEventListener('load', winloaded, false);
function winloaded(){
app();
}
function app(){
var canv = document.getElementById("canvas");
if(!canv || !canv.getContext){
return;
}
var ctx = canv.getContext("2d");
if(!ctx){
return;
}
var whichBall=0;
var n;
var diffAngle;
var hitValue = false;
var mouseX;
var mouseY;
var nuRadPoint;
var nuAngle;
var cAngle = 0;
var a45 = .7854;
var nuRadius = 0;
var engage = cAngle;
var gear;
var bSpeed = .02;
var holdMouse = false;
var clutch = {x:0, y:0};
var circle = {ctrX:250, ctrY: 250,radius: 100, angle: 0};
tCircle = {x:circle.ctrX - 250,y:circle.ctrY - 250};
gCircle ={x:circle.ctrX,y:circle.ctrY};
var y270 = circle.ctrY - circle.radius - 25;
var y90 = circle.ctrY + circle.radius + 25;
var x0 = circle.ctrX + circle.radius + 25;
var ball = [{x:0, y:0,r:25},{x:0, y:0,r:25},{x:0, y:0,r:25},{x:0, y:0,r:25},{x:0, y:0,r:25}];
var p1 ={x:circle.ctrX, y:circle.ctrY}; //center point constant
var p2 = {x: mouseX, y:mouseY}; //point from mouse coordinates 
var p3 = {x:circle.ctrX + circle.radius, y:circle.ctrY}; //radius point
var rCircle = false;
function hitTest(mouseX,mouseY,circle){
mX = mouseX;
mY = mouseY;
crX = circle.x + circle.r;
clX = circle.x - circle.r;
ctY = circle.y - circle.r;
cbY = circle.y + circle.r;
hitValue = false;
if( (mX < crX) && (mX > clX) && (mY > ctY) &&(mY < cbY) ){
hitValue = true;
}else{
hitValue = false;
}
return hitValue;
}
function find_angle(p0,p1,c) {
    var p0c = Math.sqrt(Math.pow(c.x-p0.x,2)+
                        Math.pow(c.y-p0.y,2)); // p0->c (b)   
    var p1c = Math.sqrt(Math.pow(c.x-p1.x,2)+
                        Math.pow(c.y-p1.y,2)); // p1->c (a)
    var p0p1 = Math.sqrt(Math.pow(p1.x-p0.x,2)+
                         Math.pow(p1.y-p0.y,2)); // p0->p1 (c)
    return Math.acos((p1c*p1c+p0c*p0c-p0p1*p0p1)/(2*p1c*p0c));
}
function draw(){

ctx.fillStyle ='#eeeeee';
ctx.fillRect(0,0, canvas.width, canvas.height);
ctx.strokeStyle='#000000';
ctx.strokeRect(1,1,canvas.width - 2, canvas.height - 2);

function eClacked(event){
holdMouse = false;
bSpeed = 0.02;
rCircle = false;
//console.log("release mouse button " + holdMouse);
}

function eClicked(event){

if (event.layerX || event.layerX == 0) {
            mouseX = event.layerX;
            mouseY = event.layerY;
        } else if (event.offsetX || event.offsetX == 0) {
            mouseX = event.offsetX;
            mouseY = event.offsetY;
        }
		var p2 = {x: mouseX, y:mouseY}; //point from mouse coordinates 
	for(var i = 0; i < ball.length; i++){	
hitTest(mouseX,mouseY,ball[i]);
if(hitValue == true){
whichBall = i;
holdMouse = true;
nuRadPoint = ball[i];
bSpeed = 0.0;
console.log( "ball obj: " + nuRadPoint);
}
//console.log("hold mouse button " + holdMouse);
}
}
p2 = {x: mouseX, y:mouseY}; //point for mouse
p3 = {x:circle.ctrX + circle.radius, y:circle.ctrY}; //radius point
if(holdMouse == true){
canv.addEventListener('mousemove', eMouseMove, false);
function eMouseMove(event) {	
        if (event.layerX || event.layerX == 0) {
            mouseX = event.layerX;
            mouseY = event.layerY;
        } else if (event.offsetX || event.offsetX == 0) {
            mouseX = event.offsetX;
            mouseY = event.offsetY;
        }
    }
	if(mouseY > y270 && mouseY < circle.ctrY && mouseX <= x0){
    nuRadius = -(find_angle(p2,p3,p1));
	}else if(mouseY > circle.ctrY && mouseY < y90 && mouseX <=x0){
	nuRadius = find_angle(p2,p3,p1);
	}
clutch.x = circle.ctrX + Math.cos(nuRadius)* circle.radius;
clutch.y = circle.ctrY + Math.sin(nuRadius)* circle.radius;	
//engage = nuRadius;
console.log("nuRadius: " + nuRadius);
rCircle = true;
	}
clutch.x = circle.ctrX + Math.cos(nuRadius)* circle.radius;
clutch.y = circle.ctrY + Math.sin(nuRadius)* circle.radius;
ctx.strokeStyle ="#2EEE09";
ctx.beginPath();
ctx.arc(clutch.x,clutch.y,15,0,Math.PI*2,true);
ctx.stroke();
ctx.closePath();
if(rCircle == true){
ctx.save();
gCircle.x =tCircle.x;
gCircle.y =tCircle.y;
ctx.setTransform(1,0,0,1,0,0);
ctx.translate(circle.ctrX + (0.05 * 100), circle.ctrY + (0.05 * 100));
ctx.rotate(nuRadius);
clutch.x = gCircle.x + Math.cos(gear)* circle.radius;
clutch.y = gCircle.y + Math.sin(gear)* circle.radius;	
console.log("angle of gear: " + gear);
}else{

gCircle = {x:circle.ctrX,y:circle.ctrY};
}
ctx.strokeStyle ="#000000";
ctx.beginPath();
ctx.arc(gCircle.x,gCircle.y,circle.radius,0,Math.PI*2,true);
ctx.stroke();
ctx.closePath();


for(var i = 0; i < ball.length; i++){
switch(whichBall)
{
case 0:
gear = engage + (i * a45);
console.log("case 0: " + gear);
break;
case 1:
gear = (engage + (i * a45)) - 0.7854;
console.log("case 1: " + gear);
break;
case 2:
gear = (engage + (i * a45)) - 1.5708;
console.log("case 2: " + gear);
break;
case 3:
gear = (engage + (i * a45)) - 2.3552;
console.log("case 3: " + gear);
break;
case 4:
gear = (engage + (i * a45))- 3.14;
console.log("case 4: " + gear);
break;
default:
gear = engage + (i * a45);
console.log("case default: " + gear);
}
//gear = engage + (i * a45);
console.log("ball placement: " + gear);
ball[i].x = gCircle.x + Math.cos(gear)* circle.radius;
ball[i].y = gCircle.y + Math.sin(gear)* circle.radius;
ctx.fillStyle = '#e756e8';
ctx.beginPath();
ctx.arc(ball[i].x,ball[i].y,ball[i].r,0,Math.PI*2,true);
ctx.stroke();
ctx.closePath();
}
ctx.restore();
gear += bSpeed;
//if(gear > 6.28){
//gear = 0;
//}
canv.addEventListener('mousedown', eClicked, false);
canv.addEventListener('mouseup', eClacked, false);
}	
const FRAME_RATE = 30;
var intervalTime = 1000/FRAME_RATE;
setInterval(draw, intervalTime);
}
</script>
</body>
</HTML>